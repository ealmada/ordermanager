<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="mycss.css">
    <meta charset="UTF-8">
    <title>Order Manager</title>
</head>
<body>


<div class="container">
<form>
    <p>
    <h2>First step: select an operation u want to perform (Do click on search, insert or update).</h2>
    <h3>Gray fields/Non editable wont be taken into consideration for the request</h3>
    </p>
    <div id="selector" class="btn-group">
        <button type="button" class="btn search">Search</button>
        <button type="button" class="btn update">Update</button>
        <button type="button" class="btn insert">Insert</button>
        <button type="button" class="btn delete">Delete</button>
    </div>

    <div class="col-sm-6">
        <div class="form-group row">
        <label for="idOrder" class="col-sm-2 col-form-label">Id</label>
        <div class="col-sm-10">
            <small id="idOrderHelp" class="form-text text-muted">If you do click on insert it won't be consider. Id is autogenerated.</small>
            <input type="text" class="form-control" id="idOrder" aria-describedby="idOrderHelp" placeholder="Enter an Id">
        </div>
        </div>

        <div class="form-group row">
        <label for="nameOrder" class="col-sm-2 col-form-label">Name Order</label>
            <div class="col-sm-10">
            <input type="text" class="form-control" id="nameOrder" placeholder="Enter a name" maxlength="100">
            </div>
        </div>
        <div class="form-group row">
            <label for="Amount" class="col-sm-2 col-form-label">Amount</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="amount" placeholder="Enter an amount">
            </div>
        </div>
        <div class="form-group row">
            <label for="Discount" class="col-sm-2 col-form-label">Discount</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="discount" placeholder="Enter a discount">
            </div>
        </div>
    </div>

    <input type = "button" name = "go" value = "Go" class="btn btn-primary" onclick="goToAction()">


</form>
</div>

<div class="container">
    <p>
    <h5>Only the inserts are being rendered below by Ajax</h5>
    </p>
    <table class="table table-striped" id="myInsertTable">
        <tr>
            <th scope="col">ID</th>
            <th scope="col">ORDER NAME</th>
            <th scope="col">AMOUNT</th>
            <th scope="col">DISCOUNT</th>
        </tr>
    </table>
</div>

</body>
</html>

<script>

    var selectedOption = null;

    $('#selector button').click(function() {
    $(this).addClass('active').siblings().removeClass('active');
    if(this.classList.contains("search")){
        $("#idOrder").prop("readonly", false);
        $("#nameOrder").prop("readonly", true);
        $("#amount").prop("readonly", true);
        $("#discount").prop("readonly", true);
        selectedOption = "search";
    }else if(this.classList.contains("update")){
        $("#idOrder").prop("readonly", false);
        $("#nameOrder").prop("readonly", false);
        $("#amount").prop("readonly", false);
        $("#discount").prop("readonly", false);
        selectedOption="update";
    }else if(this.classList.contains("insert")) {
        $("#idOrder").prop("readonly", true);
        $("#nameOrder").prop("readonly", false);
        $("#amount").prop("readonly", false);
        $("#discount").prop("readonly", false);
        selectedOption="insert";
    }else if(this.classList.contains("delete")){
        $("#idOrder").prop("readonly", false);
        $("#nameOrder").prop("readonly", true);
        $("#amount").prop("readonly", true);
        $("#discount").prop("readonly", true);
        selectedOption = "delete";
    }
});

function goToAction(){


    if(selectedOption=="search"){
        RestGet();
    }else if(selectedOption=="update"){
        RestPut();
    }else if(selectedOption=="insert") {
        RestPost();
    }else if(selectedOption=="delete") {
        RestDelete();
    }

}

function refreshInsert(result) {

    var row = $('<tr>').addClass('btablear').append($('<th scope="row">').text(result.id));
    row.append($('<td>').text(result.nameOrder));
    row.append($('<td>').text(result.amount));
    row.append($('<td>').text(result.discount));

    $('#myInsertTable').append(row);
}

var RestGet = function() {

    $.ajax('/pedidos/'+$("#idOrder").val(), {
        type: "GET",
        contentType: "application/json",
        success: function (data) {
            alert("Data: " + JSON.stringify(data, null, '\t') + "\nStatus: " + status)
        },
        error: function (data){
            alert("Data: " + JSON.stringify(data, null, '\t') + "\nStatus: " + status);
        }
    });
}

var RestPost= function() {

    $.ajax('/pedidos/create/', {
        type: "POST",
        data: '{"id":null'+
        ',"nameOrder":"'+$("#nameOrder").val()+'"'+
        ',"amount":'+parseInt($("#amount").val(), 10)+
        ',"discount":'+parseInt($("#discount").val(), 10)+'}',
        contentType: "application/json",
        success: refreshInsert,
        error: function (data){
            alert("Data: " + JSON.stringify(data, null, '\t') + "\nStatus: " + status);
        }
    });
}

var RestPut= function() {

        $.ajax('/pedidos/update/'+$("#idOrder").val(), {
            type: "PUT",
            data: '{"id":'+parseInt($("#idOrder").val(), 10)+
            ',"nameOrder":"'+$("#nameOrder").val()+'"'+
            ',"amount":'+parseInt($("#amount").val(), 10)+
            ',"discount":'+parseInt($("#discount").val(), 10)+'}',
            contentType: "application/json",
            success: function () {
                // TODO

            },
            error: function (data){
                alert("Data: " + JSON.stringify(data, null, '\t') + "\nStatus: " + status);
            }

        });
}

var RestDelete= function() {

    $.ajax('/pedidos/'+$("#idOrder").val(), {
        type: "DELETE",
        data: '{"id":'+parseInt($("#idOrder").val(), 10)+'}',
        contentType: "application/json",
        success: function () {
            alert("Data: " + JSON.stringify(data, null, '\t') + "\nStatus: " + status);
        },
        error: function (data){
            alert("Data: " + JSON.stringify(data, null, '\t') + "\nStatus: " + status);
        }

    });
}
</script>